<div class="cell">
  <div class="bd">

    <div class="weui_cells weui_cells_form">
      <div class="weui_cell">
        <div class="weui_cell_bd weui_cell_primary">
          <div class="weui_uploader">
            <div class="weui_uploader_bd">
              <ul class="weui_uploader_files">
              </ul>
              <div class="weui_uploader_input_wrp">
                <input class="weui_uploader_input" type="button"/>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="weui_cell">
        <div class="weui_cell_bd weui_cell_primary">
          <textarea id="product_name" class="weui_textarea ydw_font_small" placeholder="标题" rows="1"></textarea>
        </div>
      </div>
      <div class="weui_cell">
        <div class="weui_cell_bd weui_cell_primary">
          <input id="price" class="weui_input" type="number" placeholder="请输入希望金额">
        </div>
      </div>
      <div class="weui_cell">
        <div class="weui_cell_bd weui_cell_primary">
          <textarea id="product_desc" class="weui_textarea ydw_font_small" placeholder="详细说明" rows="4"></textarea>
        </div>
      </div>
    </div>

    <div class="ydw_bottom_area">
      <div class="weui-row">
        <div class="weui-col-100">
          <a href="javascript:;" id="btn_new_product" class="weui_btn weui_btn_primary">发布</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Locate_nav end-->
{{#extend "scripts"}}
<script>
 jsApilist = jsApilist.concat([
     'chooseImage',
     'uploadImage',
     'previewImage'
 ]);
 var previewUrls = [];
 $(function () {
     $('#btn_new_product').click(function () {
         $.showLoading('数据提交中');
         $.ajax({
             url: '/product/new',
             type: 'post',
             data: {
                 seller: '{{req.session.user._id}}',
                 product_detail: {
                     product_name: $('#product_name').val(),
                     price: $('#price').val(),
                     product_desc: $('#product_desc').val(),
                     images: previewUrls
                 }
             }
         }).done(function(res) {
             $.hideLoading();
             $.toast('数据上传完毕。');
         });

     });
     $('.weui_uploader_input').click(function () {
         wx_upload('/product/upload', function(data) {
             if(data.success){
                 previewUrls.push(data.image);
                 var insertHtml = '<li class=\"weui_uploader_file\" style=\"background-image:url(' + data.image + ')\" onclick=\"javascript:previewImage(\'' + data.image + '\');\"></li>';
                 $('.weui_uploader_files').append(insertHtml);
             } else {
                 $.toast('图片上载出错啦', 'forbidden');
             }
         });
     });

 });
 function previewImage(url) {
     wx.previewImage({
         current: url,
         urls: previewUrls
     });
 };

</script>
{{/extend}}
